  <odoo>
    <record id="ai_action_create_opportunity" model="ir.actions.server">
        <field name="name">Crear Oportunidad</field>
        <field name="model_id" ref="crm.model_crm_lead"/>
        <field name="state">code</field>
        <field name="code">
from datetime import datetime
try:
    # Convertir expected_revenue a float si es string
    exp_rev = 0.0
    if expected_revenue:
        if isinstance(expected_revenue, str):
            exp_rev = float(''.join(c for c in expected_revenue if c.isdigit() or c == '.'))
        else:
            exp_rev = float(expected_revenue)
except:
    exp_rev = 0.0

result = env['ai.crm.actions'].create_opportunity(
    name=name,
    customer_name=customer_name,
    email=email,
    phone=phone,
    stage_name=stage_name,
    expected_revenue=exp_rev
)
        </field>
        <field name="use_in_ai">True</field>
        <field name="ai_tool_description">Crea una oportunidad CRM con nombre, cliente, email, teléfono, etapa e ingreso esperado</field>
        <field name="ai_action_prompt">Cuando el usuario pide crear una oportunidad, SIEMPRE extrae ESTOS 6 PARÁMETROS OBLIGATORIOS del texto:
- name: nombre de la oportunidad (ej: 'Proyecto Web')
- customer_name: nombre del cliente (ej: 'Acme Corp')
- email: email del cliente (ej: 'info@acme.com')
- phone: teléfono (ej: '5551234')
- stage_name: nombre de la etapa EXACTA en el sistema: 'New', 'Qualified', 'Proposition', o 'Won'
- expected_revenue: número sin caracteres especiales (ej: 10000)
Luego ejecuta esta herramienta con los 6 parámetros.</field>
    </record>
</odoo>